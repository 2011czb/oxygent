# RAG æ–‡ä»¶æœç´¢ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½è¯´æ˜

RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»ç»Ÿå¸®åŠ© LLM å¿«é€Ÿå®šä½é¡¹ç›®ä¸­çš„å‚è€ƒæ–‡ä»¶ï¼Œè§£å†³"LLM çœ‹ä¸åˆ°é¡¹ç›®æ–‡ä»¶"çš„é—®é¢˜ã€‚

## ğŸ“ ç³»ç»Ÿç»„æˆ

### 1. **file_indexer.py** - æ–‡ä»¶ç´¢å¼•å™¨
- æ‰«æé¡¹ç›®ç›®å½•ï¼Œå»ºç«‹æ–‡ä»¶å…ƒæ•°æ®ç´¢å¼•
- æå–æ–‡ä»¶åå…³é”®è¯
- æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—æ··åˆåŒ¹é…

### 2. **file_search_tool.py** - æ–‡ä»¶æœç´¢å·¥å…·
- æä¾› `search_files` å’Œ `list_files_by_type` ä¸¤ä¸ªå·¥å…·
- ä¾› Agent è°ƒç”¨ï¼Œæ ¹æ®æŸ¥è¯¢æ‰¾åˆ°ç›¸å…³æ–‡ä»¶

### 3. **è‡ªåŠ¨é›†æˆ**
- `valid_runner.py` è¿è¡Œæ—¶è‡ªåŠ¨æ„å»ºç´¢å¼•
- Master Agent å¯ä»¥ä½¿ç”¨æ–‡ä»¶æœç´¢å·¥å…·

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨ä½¿ç”¨ï¼ˆæ¨èï¼‰

è¿è¡Œ valid_runner æ—¶è‡ªåŠ¨æ„å»ºå’Œä½¿ç”¨ï¼š

```bash
cd OxyGent
python valid_runner.py --input ../åˆèµ›æ•°æ®é›†/valid/data.jsonl --output ../valid_result.jsonl --test_dir ../åˆèµ›æ•°æ®é›†/valid
```

**é¦–æ¬¡è¿è¡Œ**ä¼šè‡ªåŠ¨ï¼š
1. æ‰«æ `åˆèµ›æ•°æ®é›†` ç›®å½•
2. æ„å»ºæ–‡ä»¶ç´¢å¼• â†’ `file_index.json`
3. ä½¿ç´¢å¼•å¯ä¾› Agent ä½¿ç”¨

**åç»­è¿è¡Œ**ä¼šï¼š
- ä½¿ç”¨å·²æœ‰ç´¢å¼•ï¼ˆå¿«é€Ÿå¯åŠ¨ï¼‰
- å¦‚éœ€é‡å»ºç´¢å¼•ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼š`export REBUILD_INDEX=1`

### æ‰‹åŠ¨æ„å»ºç´¢å¼•

å¦‚æœæƒ³å•ç‹¬æ„å»ºç´¢å¼•ï¼š

```bash
cd OxyGent
python file_indexer.py ../åˆèµ›æ•°æ®é›†
```

è¾“å‡ºï¼š
```
================================================================================
æ–‡ä»¶ç´¢å¼•æ„å»ºå™¨
================================================================================
ğŸ“ æ‰«æç›®å½•: ../åˆèµ›æ•°æ®é›†
âœ“ ç´¢å¼•å®Œæˆ: 42 ä¸ªæ–‡ä»¶
ğŸ’¾ ç´¢å¼•å·²ä¿å­˜åˆ°: file_index.json

================================================================================
æµ‹è¯•æ–‡ä»¶æ£€ç´¢
================================================================================

æŸ¥è¯¢: PDFæ–‡æ¡£
  1. bbasd8.pdf (document) - åˆèµ›æ•°æ®é›†/valid/bbasd8.pdf
  2. hqwqa3.pdf (document) - åˆèµ›æ•°æ®é›†/valid/hqwqa3.pdf
  ...
```

## ğŸ” æœç´¢åŠŸèƒ½

### 1. search_files - æ™ºèƒ½æœç´¢

Agent å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```json
{
  "tool_name": "search_files",
  "arguments": {
    "query": "PDF æ–‡æ¡£ ç§’é€",
    "file_type": "document",
    "max_results": 5
  }
}
```

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "query": "PDF æ–‡æ¡£ ç§’é€",
  "found": 2,
  "files": [
    {
      "path": "åˆèµ›æ•°æ®é›†/valid/hqwqa3.pdf",
      "name": "hqwqa3.pdf",
      "type": "document"
    },
    {
      "path": "åˆèµ›æ•°æ®é›†/valid/bbasd8.pdf",
      "name": "bbasd8.pdf",
      "type": "document"
    }
  ]
}
```

### 2. list_files_by_type - æŒ‰ç±»å‹åˆ—å‡º

```json
{
  "tool_name": "list_files_by_type",
  "arguments": {
    "file_type": "video",
    "max_results": 10
  }
}
```

## ğŸ“Š æ”¯æŒçš„æ–‡ä»¶ç±»å‹

| ç±»å‹ | æ‰©å±•å | è¯´æ˜ |
|------|--------|------|
| **document** | .pdf, .pptx, .docx, .txt, .md | æ–‡æ¡£æ–‡ä»¶ |
| **image** | .jpg, .jpeg, .png, .gif | å›¾ç‰‡æ–‡ä»¶ |
| **video** | .mp4, .avi, .mov, .mkv | è§†é¢‘æ–‡ä»¶ |
| **audio** | .mp3, .wav, .m4a | éŸ³é¢‘æ–‡ä»¶ |
| **data** | .json, .jsonl, .csv, .xlsx | æ•°æ®æ–‡ä»¶ |
| **web** | .html, .htm | ç½‘é¡µæ–‡ä»¶ |

## ğŸ¯ åŒ¹é…è§„åˆ™

æœç´¢ç›¸å…³åº¦è¯„åˆ†ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. **Task ID å®Œå…¨åŒ¹é…** (+20åˆ†)
   - æ–‡ä»¶ååŒ…å«ä¸æŸ¥è¯¢ç›¸åŒçš„ UUID

2. **æ–‡ä»¶åå®Œå…¨åŒ¹é…** (+10åˆ†)
   - æŸ¥è¯¢å…³é”®è¯åœ¨æ–‡ä»¶åä¸­

3. **æ–‡ä»¶ç±»å‹åŒ¹é…** (+3åˆ†)
   - æŸ¥è¯¢æåˆ°"PDF"ï¼Œæ–‡ä»¶æ˜¯ .pdf

4. **å…³é”®è¯åŒ¹é…** (+2åˆ†/ä¸ª)
   - æ–‡ä»¶åå…³é”®è¯ä¸æŸ¥è¯¢å…³é”®è¯é‡å 

5. **éƒ¨åˆ†åŒ¹é…** (+0.5åˆ†/ä¸ª)
   - å…³é”®è¯åŒ…å«å…³ç³»

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šæŸ¥æ‰¾ PDF æ–‡æ¡£

**æŸ¥è¯¢**: "æ ¹æ®pdfå†…å®¹å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œå‡è®¾ç”¨æˆ·åœ¨ç§’é€ä¸‹å•..."

**ç³»ç»Ÿè¡Œä¸º**:
1. Agent è°ƒç”¨ `search_files(query="ç§’é€ pdf", file_type="document")`
2. æ‰¾åˆ° `hqwqa3.pdf`
3. ä½¿ç”¨ `read_pdf` è¯»å–å†…å®¹
4. å›ç­”é—®é¢˜

### åœºæ™¯2ï¼šæŸ¥æ‰¾è§†é¢‘æ–‡ä»¶

**æŸ¥è¯¢**: "è§†é¢‘ä¸­ç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ªå•†å“é“¾æ¥..."

**ç³»ç»Ÿè¡Œä¸º**:
1. Agent è°ƒç”¨ `search_files(query="å•†å“", file_type="video")`
2. æ‰¾åˆ° `knoa2.mp4`
3. ä½¿ç”¨ `video_agent` åˆ†æ
4. å›ç­”é—®é¢˜

### åœºæ™¯3ï¼šæŸ¥æ‰¾å›¾ç‰‡

**æŸ¥è¯¢**: "è¯·ä½ åˆ†æå›¾ä¸­çš„äººç‰©èº«ä»½..."

**ç³»ç»Ÿè¡Œä¸º**:
1. Agent è°ƒç”¨ `search_files(query="äººç‰©", file_type="image")`
2. æ‰¾åˆ° `20240414fa6.jpg`
3. ä½¿ç”¨ `image_agent` åˆ†æ
4. å›ç­”é—®é¢˜

## âš™ï¸ é…ç½®é€‰é¡¹

### é‡å»ºç´¢å¼•

```bash
# å¼ºåˆ¶é‡å»ºç´¢å¼•ï¼ˆæ‰«ææ–‡ä»¶å˜åŒ–ï¼‰
export REBUILD_INDEX=1
python valid_runner.py ...
```

### è‡ªå®šä¹‰ç´¢å¼•ä½ç½®

ç¼–è¾‘ `file_indexer.py`:
```python
# ä¿®æ”¹é»˜è®¤ç´¢å¼•ç›®å½•
if __name__ == "__main__":
    data_dir = "ä½ çš„æ•°æ®ç›®å½•"
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæœç´¢è¿”å›"æ–‡ä»¶ç´¢å¼•æœªåˆå§‹åŒ–"

**è§£å†³**ï¼š
```bash
cd OxyGent
python file_indexer.py ../åˆèµ›æ•°æ®é›†
```

### é—®é¢˜2ï¼šæ‰¾ä¸åˆ°æ–‡ä»¶

**åŸå› **ï¼š
- æ–‡ä»¶ä¸åœ¨ç´¢å¼•çš„ç›®å½•ä¸­
- æ–‡ä»¶ç±»å‹ä¸æ”¯æŒ
- å…³é”®è¯åŒ¹é…åº¦å¤ªä½

**è§£å†³**ï¼š
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨ `åˆèµ›æ•°æ®é›†` ç›®å½•ä¸‹
2. æŸ¥çœ‹ `file_index.json` ç¡®è®¤æ–‡ä»¶å·²è¢«ç´¢å¼•
3. è°ƒæ•´æŸ¥è¯¢å…³é”®è¯

### é—®é¢˜3ï¼šä¸­æ–‡æœç´¢ä¸å‡†ç¡®

**ä¼˜åŒ–**ï¼š
- ä½¿ç”¨æ›´å…·ä½“çš„å…³é”®è¯
- æŒ‡å®š `file_type` è¿‡æ»¤
- å¢åŠ  `max_results` è·å–æ›´å¤šå€™é€‰

## ğŸ“ˆ æ•ˆæœé¢„æœŸ

### ä¿®å¤å‰ï¼ˆæ— RAGï¼‰

âŒ LLM å›ç­”ï¼š"æˆ‘éœ€è¦æŸ¥çœ‹æ–‡ä»¶æ‰èƒ½å›ç­”ï¼Œè¯·æä¾›æ–‡ä»¶è·¯å¾„"  
âŒ LLM å›ç­”ï¼š"æ— æ³•è®¿é—®é¡¹ç›®æ–‡ä»¶"

### ä¿®å¤åï¼ˆæœ‰RAGï¼‰

âœ… Agent è‡ªåŠ¨æœç´¢æ–‡ä»¶  
âœ… Agent æ‰¾åˆ°ç›¸å…³æ–‡ä»¶  
âœ… Agent è¯»å–æ–‡ä»¶å†…å®¹  
âœ… Agent ç»™å‡ºæ­£ç¡®ç­”æ¡ˆ

**é¢„æœŸæå‡**ï¼šéœ€è¦å‚è€ƒæ–‡ä»¶çš„é¢˜ç›®ä» 0% â†’ 60%+

## ğŸ“ æŠ€æœ¯åŸç†

### ç®€åŒ–çš„RAGæµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢ â†’ Agent è°ƒç”¨ search_files
         â†“
    å…³é”®è¯æå– + æ–‡ä»¶ç±»å‹è¯†åˆ«
         â†“
    è®¡ç®—ç›¸å…³åº¦åˆ†æ•°ï¼ˆåŒ¹é…ç®—æ³•ï¼‰
         â†“
    è¿”å› Top-K æ–‡ä»¶è·¯å¾„
         â†“
    Agent è°ƒç”¨ read_pdf/read_pptx ç­‰å·¥å…·
         â†“
    è·å–æ–‡ä»¶å†…å®¹ â†’ LLM åˆ†æ â†’ ç­”æ¡ˆ
```

### æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **å‘é‡æ£€ç´¢**ï¼šä½¿ç”¨ embedding æé«˜è¯­ä¹‰åŒ¹é…
2. **ç¼“å­˜ä¼˜åŒ–**ï¼šé¿å…é‡å¤è¯»å–åŒä¸€æ–‡ä»¶
3. **æ™ºèƒ½åˆ†å—**ï¼šé•¿æ–‡æ¡£è‡ªåŠ¨åˆ†å—æ£€ç´¢
4. **å¤šæ¨¡æ€ç´¢å¼•**ï¼šç´¢å¼•å›¾ç‰‡/è§†é¢‘çš„å†…å®¹æè¿°

## ğŸ“ API å‚è€ƒ

### search_files

```python
def search_files(
    query: str,              # æœç´¢æŸ¥è¯¢
    file_type: Optional[str] = None,  # æ–‡ä»¶ç±»å‹è¿‡æ»¤
    max_results: int = 5     # æœ€å¤§ç»“æœæ•°
) -> str:  # è¿”å› JSON å­—ç¬¦ä¸²
```

### list_files_by_type

```python
def list_files_by_type(
    file_type: str,          # æ–‡ä»¶ç±»å‹
    max_results: int = 10    # æœ€å¤§ç»“æœæ•°
) -> str:  # è¿”å› JSON å­—ç¬¦ä¸²
```

---

**åˆ›å»ºæ—¶é—´**: 2025-01-XX  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å·²é›†æˆåˆ° valid_runner

